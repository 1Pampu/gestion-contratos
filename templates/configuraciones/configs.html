{% extends "global/base.html" %}

{% block main %}
    <div class="mx-auto p-2" style="width: 1000px;">
        <h1 class="text-center mt-2 mb-3">Configuraciones</h1>
        <div>
            <h2>Backups</h2>
            <div class="alert alert-secondary mb-2">
                <div class="d-flex align-items-center">
                    <p class="mb-0">Realizar una copia de la base de datos.</p>
                    <button type="button" class="btn btn-primary mb-0 ms-auto" id="BackupAlertBtn" onclick="realizar_backup()">Realizar BackUp</button>
                </div>
                <div id="BackupAlertPlaceholder"></div>
            </div>
            <div class="alert alert-secondary d-flex align-items-center mb-2">
                <p class="mb-0">Mostrar la lista de los BackUps existentes en el servidor.</p>
                <a href="#" class="btn btn-primary mb-0 ms-auto">Ver Lista</a>
            </div>
            <div class="alert alert-secondary d-flex align-items-center mb-2">
                <p class="mb-0">Programar la copia de seguridad automatica.</p>
                <a href="#" class="btn btn-primary mb-0 ms-auto">Programar</a>
            </div>
            <div class="alert alert-secondary d-flex align-items-center mb-2">
                <p class="mb-0">Restaurar base de datos a partir de un BackUp.</p>
                <a href="#" class="btn btn-primary mb-0 ms-auto">Restaurar</a>
            </div>
        </div>
    </div>

    <script>
        // ALERT MESSAGE REALIZAR BACKUP NOW
        const alertPlaceholder = document.getElementById('BackupAlertPlaceholder')
        const appendAlert = (message, type) => {
            const wrapper = document.createElement('div')
            wrapper.innerHTML = [
                `<div class="alert alert-${type} mb-0 mt-2 d-flex align-items-center fade show" role="alert">`,
                `   <div class="mb-0">${message}</div>`,
                `   <a href="{% url "descargar_ultimo_backup" %}" class="btn btn-success mb-0 ms-auto me-3">Descargar</a>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('')
            alertPlaceholder.append(wrapper)
        }

        // REALIZAR BACKUP
        function realizar_backup() {
            fetch("{% url 'backup' %}")
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al realizar el backup');
                }
                return response.text();
            })
            .then(data => {
                appendAlert(data, 'success');
            })
            .catch(error => {
                appendAlert(error.message, 'danger');
            });
        }
    </script>
{% endblock %}